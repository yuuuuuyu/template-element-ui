import{e,d as t}from"./account.280f78c8.js";import{n as a}from"./index.533ed093.js";import"./ui.1d6f8af4.js";const s=a({data:()=>({loading:!1,userDetail:{},rules:{}}),computed:{userInfo(){return this.$store.user}},watch:{userInfo:{handler(){this.userInfo&&this.userInfo.id&&this.fetchData()},immediate:!0}},methods:{handleSubmit(){this.$refs.validForm.validate((async e=>{e&&this.doSubmit(this.userDetail)}))},doSubmit(t={}){this.loading=!0,e({...this.userDetail,...t}).then((()=>{this.$store.getUser({cache:"update"}).then((()=>{this.loading=!1,this.$message.success("更新成功！")}))})).catch((()=>{this.loading=!1}))},handleUpload(e){e.id&&this.doSubmit({avatar:e.id})},handleChangePw(){this.$refs.auth.auth().then((e=>{this.$router.push({name:"修改密码",query:{authCode:e}})}))},fetchData(){this.loading=!0,t({id:this.userInfo.id}).then((e=>{this.loading=!1,this.userDetail=e.data})).catch((()=>{this.loading=!1}))}}},(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("ToolBar"),e.userDetail&&e.userDetail.id?t("div",{staticClass:"infoBox wrap"},[t("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:e.userDetail.avatarExt?[{url:e.userDetail.avatarExt.url}]:[],imgCrop:"","show-file-list":!1,"on-success":e.handleUpload}},[e.userDetail.avatarExt?t("img",{attrs:{src:e.userDetail.avatarExt.url,alt:""}}):t("span",[e._v("上传头像")])]),t("el-form",{attrs:{"label-width":"80px","label-position":"right",size:"small"}},[t("el-form-item",{attrs:{label:"用户名"}},[e._v(e._s(e.userDetail.name))]),t("el-form-item",{attrs:{label:"密码"}},[t("el-button",{attrs:{type:"text"},on:{click:e.handleChangePw}},[e._v(" 修改密码 "),t("i",{staticClass:"el-icon-edit"})])],1),t("el-form-item",{attrs:{label:"手机号"}},[e._v(e._s(e.userDetail.mobile))]),t("el-form-item",{attrs:{label:"所属组织"}},[e._v(e._s(e.userDetail.org&&e.userDetail.org.name))])],1),t("el-form",{ref:"validForm",attrs:{model:e.userDetail,rules:e.rules,"label-width":"80px","label-position":"right",size:"small"},nativeOn:{submit:function(e){return e.preventDefault(),(()=>{}).apply(null,arguments)}}},[t("el-form-item",{attrs:{label:"联系地址",prop:"address"}},[t("el-input",{model:{value:e.userDetail.address,callback:function(t){e.$set(e.userDetail,"address",t)},expression:"userDetail.address"}})],1),t("el-form-item",{attrs:{label:"个人介绍",prop:"introduction"}},[t("el-input",{model:{value:e.userDetail.introduction,callback:function(t){e.$set(e.userDetail,"introduction",t)},expression:"userDetail.introduction"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v(" 保 存 ")])],1)],1)],1):e._e(),t("auth",{ref:"auth",attrs:{types:["password","email","mobile"]}})],1)}),[],!1,null,"e683e004",null,null).exports;export{s as default};
