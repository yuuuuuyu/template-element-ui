import{n as e,_ as t,d as a}from"./index.346c828d.js";import{a as r,r as o,b as i,e as s,c as l,l as n}from"./account.6304b990.js";import{l as c}from"./role.8c26869a.js";import"./ui.1d6f8af4.js";const d=e({components:{OrgPicker:()=>t((()=>import("./OrgPicker.2818f9ea.js")),["./OrgPicker.2818f9ea.js","./index.346c828d.js","./ui.1d6f8af4.js","./index.5a4c7fc5.css","./org.2fdfd921.js","./OrgPicker.c70f2e0a.css"],import.meta.url)},data(){return{account:r,dialogVisible:!1,loading:!1,list:[],editForm:{id:"",account:"",name:"",password:"",roles:[],disabled:!1},queryParam:{pageSize:20,p:1,account:"",name:""},totalCount:0,totalPage:0,rules:{account:[{required:!0,message:"请输入账号",trigger:"blur"}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{validator:(e,t,a)=>{t?(""!==this.editForm.checkPass&&this.$refs.editForm.validateField("checkPass"),a()):a(new Error("请输入密码"))},trigger:"blur"}],checkPass:[{validator:(e,t,a)=>{t?t!==this.editForm.password?a(new Error("两次输入密码不一致!")):a():a(new Error("请再次输入密码"))},trigger:"blur"}],orgId:[{required:!0,message:"请选择所属组织"}]},requestRoles:c}},methods:{resetSearch(){this.queryParam={pageSize:20,p:1,account:"",name:""},this.fetchData(!0)},orgAdapter(e){var t;return(null==(t=this.editForm.org)?void 0:t.name)||e},resetPassword:function(e){if(!e)return null;this.$confirm(`确定重置账号 ${e.account} 的密码?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,o({id:e.id}).then((e=>{e.data.password?this.$clipboard(e.data.password).then((()=>{this.$alert(`新密码已复制到剪贴板，请保管好新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})).catch((()=>{this.$alert(`密码已重置，请牢记新密码：<code>${e.data.password}</code>`,{confirmButtonText:"我知道了",dangerouslyUseHTMLString:!0}).then((()=>{this.fetchData()}))})):this.$message.warning("操作失败，请重试")})).catch((()=>{this.loading=!1}))}))},edit:function(e){const t=Object.assign({},e);t.roles=Array.isArray(t.roles)?t.roles.map((e=>e.roleId)):[],this.editForm=t,this.dialogVisible=!0},save(){this.$refs.editForm.validate((e=>{if(e){this.loading=!0;let e=a(this.editForm);this.handleCloseDialog(),(e.id?s:i)(e).then((()=>{this.fetchData(),this.$message({message:"添加成功",type:"success"})})).catch((()=>{this.loading=!1}))}}))},handleCloseDialog:function(){this.dialogVisible=!1,this.editForm={id:"",account:"",name:"",password:"",roles:[],disabled:!1},this.$refs.editForm&&this.$refs.editForm.resetFields()},remove(e){if(!e)return null;this.$confirm("是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.loading=!0,l({id:e.id}).then((()=>{this.fetchData(),this.$message({message:"删除成功",type:"success"})})).catch((()=>{this.loading=!1}))}))},fetchData:function(e){e&&(this.queryParam.p=1),this.loading=!0,n(this.queryParam).then((e=>{this.loading=!1;const t=e.data;t&&(this.list=t.list,this.totalCount=t.totalCount,this.totalPage=t.totalPage)})).catch((()=>{this.loading=!1}))}},created:function(){this.fetchData()}},(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[t("ToolBar",[t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:e.account.add,expression:"account.add"}],attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("添加")])],1),t("el-form",{ref:"searchForm",attrs:{inline:"",model:e.queryParam,size:"small"}},[t("el-form-item",{attrs:{label:"账号"}},[t("el-input",{model:{value:e.queryParam.account,callback:function(t){e.$set(e.queryParam,"account",t)},expression:"queryParam.account"}})],1),t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.fetchData(!0)}}},[e._v("查询")]),t("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:function(t){return e.resetSearch()}}},[e._v("重置")])],1)],1),t("p",[t("i",{staticClass:"el-icon-info"}),e._v(" 共 "),t("el-button",{attrs:{type:"text"}},[e._v(e._s(e.totalCount))]),e._v(" 条记录 ")],1),t("el-table",{attrs:{data:e.list}},[t("el-table-column",{attrs:{prop:"account",label:"账号",align:"center"}}),t("el-table-column",{attrs:{prop:"name",label:"用户名",align:"center"}}),t("el-table-column",{attrs:{prop:"roleName",label:"角色",align:"center"}}),t("el-table-column",{attrs:{label:"状态",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[a.row.disabled?[t("span",{staticStyle:{color:"#ff4949"}},[e._v("已禁用")])]:[t("span",{staticStyle:{color:"#13ce66"}},[e._v("已启用")])]]}}])}),t("el-table-column",{attrs:{label:"操作",width:"300",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:e.account.edit,expression:"account.edit"}],attrs:{size:"small"},on:{click:function(t){return e.edit(a.row)}}},[e._v("编辑")]),t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:e.account.resetPassword,expression:"account.resetPassword"}],attrs:{size:"small",type:"warning",plain:""},on:{click:function(t){return e.resetPassword(a.row)}}},[e._v("重置密码")]),t("el-button",{directives:[{name:"auth",rawName:"v-auth",value:e.account.remove,expression:"account.remove"}],attrs:{size:"small",type:"danger",plain:""},on:{click:function(t){return e.remove(a.row)}}},[e._v("删除")])]}}])})],1),t("Pagination",{attrs:{"page-size":e.queryParam.pageSize,"current-page":e.queryParam.p,"total-count":e.totalCount,"total-page":e.totalPage},on:{"current-change":function(t){e.queryParam.p=t,e.fetchData()},"size-change":function(t){e.queryParam.pageSize=t,e.fetchData(!0)}}}),t("el-dialog",{staticClass:"userEditDialog",attrs:{"close-on-click-modal":!1,title:"账号信息",visible:e.dialogVisible,width:"600px"},on:{close:e.handleCloseDialog}},[t("el-form",{ref:"editForm",attrs:{size:"small",rules:e.rules,model:e.editForm,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"头像",prop:"avatar"}},[t("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:e.editForm.avatar?[{url:e.editForm.avatar}]:[],imgCrop:"","show-file-list":!1,"on-success":t=>{e.$set(e.editForm,"avatar",t.url)}}},[e.editForm.avatar?t("img",{staticClass:"upload_avatar_img",attrs:{src:e.editForm.avatar,alt:""}}):t("span",[e._v("上传头像")])])],1),t("el-form-item",{attrs:{label:"账号",prop:"account"}},[t("el-input",{attrs:{maxlength:100},model:{value:e.editForm.account,callback:function(t){e.$set(e.editForm,"account","string"==typeof t?t.trim():t)},expression:"editForm.account"}})],1),t("el-form-item",{attrs:{label:"用户名",prop:"name"}},[t("el-input",{attrs:{maxlength:100},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name","string"==typeof t?t.trim():t)},expression:"editForm.name"}})],1),e.editForm.id?e._e():[t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("input-password",{attrs:{autocomplete:"off"},model:{value:e.editForm.password,callback:function(t){e.$set(e.editForm,"password",t)},expression:"editForm.password"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[t("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.editForm.checkPass,callback:function(t){e.$set(e.editForm,"checkPass",t)},expression:"editForm.checkPass"}})],1)],t("el-form-item",{attrs:{label:"所属组织",prop:"orgId"}},[t("OrgPicker",{attrs:{adapter:e.orgAdapter},on:{change:(t,a)=>{e.editForm.org=a,e.$refs.editForm.validateField("orgId")}},model:{value:e.editForm.orgId,callback:function(t){e.$set(e.editForm,"orgId",t)},expression:"editForm.orgId"}})],1),t("el-form-item",{attrs:{label:"角色"}},[t("DictSelect",{attrs:{request:e.requestRoles,labelKey:"name"},model:{value:e.editForm.roleId,callback:function(t){e.$set(e.editForm,"roleId",t)},expression:"editForm.roleId"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-switch",{attrs:{"active-text":"启用","inactive-text":"禁用","active-value":!1,"inactive-value":!0},model:{value:e.editForm.disabled,callback:function(t){e.$set(e.editForm,"disabled",t)},expression:"editForm.disabled"}})],1)],2),t("span",{attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")]),t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")])],1)],1)],1)}),[],!1,null,"acef9f45",null,null).exports;export{d as default};
