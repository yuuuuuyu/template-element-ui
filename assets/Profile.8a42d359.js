import{e as t,d as e}from"./account.f37997cd.js";import{n as a}from"./index.c811c3b7.js";import"./ui.1d6f8af4.js";const s=a({data:()=>({loading:!1,userDetail:{},rules:{}}),computed:{userInfo(){return this.$store.user}},watch:{userInfo:{handler(){this.userInfo&&this.userInfo.id&&this.fetchData()},immediate:!0}},methods:{handleSubmit(){this.$refs.validForm.validate((async t=>{t&&this.doSubmit(this.userDetail)}))},doSubmit(e={}){this.loading=!0,t({...this.userDetail,...e}).then((()=>{this.$store.getUser({cache:"update"}).then((()=>{this.loading=!1,this.$message.success("更新成功！")}))})).catch((()=>{this.loading=!1}))},handleUpload(t){t.id&&this.doSubmit({avatar:t.id})},handleChangePw(){this.$refs.auth.auth().then((t=>{this.$router.push({name:"修改密码",query:{authCode:t}})}))},fetchData(){this.loading=!0,e({id:this.userInfo.id}).then((t=>{this.loading=!1,this.userDetail=t.data})).catch((()=>{this.loading=!1}))}}},(function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[e("ToolBar"),t.userDetail&&t.userDetail.id?e("div",{staticClass:"infoBox wrap"},[e("uploader",{staticClass:"upload_avatar",attrs:{accept:"t-image",value:t.userDetail.avatarExt?[{url:t.userDetail.avatarExt.url}]:[],imgCrop:"","show-file-list":!1,"on-success":t.handleUpload}},[t.userDetail.avatarExt?e("img",{attrs:{src:t.userDetail.avatarExt.url,alt:""}}):e("span",[t._v("上传头像")])]),e("el-form",{attrs:{"label-width":"80px","label-position":"right",size:"small"}},[e("el-form-item",{attrs:{label:"用户名"}},[t._v(t._s(t.userDetail.name))]),e("el-form-item",{attrs:{label:"密码"}},[e("el-button",{attrs:{type:"text"},on:{click:t.handleChangePw}},[t._v(" 修改密码 "),e("i",{staticClass:"el-icon-edit"})])],1),e("el-form-item",{attrs:{label:"手机号"}},[t._v(t._s(t.userDetail.mobile))]),e("el-form-item",{attrs:{label:"所属组织"}},[t._v(t._s(t.userDetail.org&&t.userDetail.org.name))])],1),e("el-form",{ref:"validForm",attrs:{model:t.userDetail,rules:t.rules,"label-width":"80px","label-position":"right",size:"small"},nativeOn:{submit:function(t){return t.preventDefault(),(()=>{}).apply(null,arguments)}}},[e("el-form-item",{attrs:{label:"联系地址",prop:"address"}},[e("el-input",{model:{value:t.userDetail.address,callback:function(e){t.$set(t.userDetail,"address",e)},expression:"userDetail.address"}})],1),e("el-form-item",{attrs:{label:"个人介绍",prop:"introduction"}},[e("el-input",{model:{value:t.userDetail.introduction,callback:function(e){t.$set(t.userDetail,"introduction",e)},expression:"userDetail.introduction"}})],1),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:t.handleSubmit}},[t._v(" 保 存 ")])],1)],1)],1):t._e(),e("auth",{ref:"auth",attrs:{types:["password","email","mobile"]}})],1)}),[],!1,null,"e683e004",null,null).exports;export{s as default};
